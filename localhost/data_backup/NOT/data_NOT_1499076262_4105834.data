id§NOT_1499076262_4105834°datum§07.07.2017°DatumE§2017-07-07-00-00-00_NOT_1499076262_4105834°quelle§persistent°name§Shellscript: Cleanup Logfiles°kategorien§.bash°info§°text§<br/>-----<br/><p>#!/bin/sh</p><p>&nbsp;</p><p># in case any command exits with 1 = failure, exit, resp. go to trap</p><p># to prevent for a command use: command-that-shall-be-able-to-fail || true</p><p>set -e&nbsp;</p><p>&nbsp;</p><p># nightly!&nbsp;</p><p>&nbsp;</p><p># create ./archive</p><p>mkdir -p ./archiv</p><p>&nbsp;</p><p># remove gz files in ./archive that are older than 14 days</p><p>find ./archiv -type f -name "*.gz" -mtime +14 -exec sh -c rm $0 {} \;</p><p>&nbsp;</p><p># gzip .bak files that are older than 2 days in ./archive/dir-backup.DATE_TIME.tar.gz</p><p>&nbsp;</p><p>tarname="./archiv/dir-backup.$(date +%Y-%m-%d_%H-%M-%S).tar"</p><p>#create empty archive</p><p>archiv=`tar cvf $tarname --files-from /dev/null`</p><p>#find all files with extension .bak-for-cleanup that are older than 2 days</p><p>files=`find ./ -type f -name "*.bak-for-cleanup" -mtime +2`</p><p>for file in $files</p><p>&nbsp; do tar --append --file=$tarname $file&nbsp;</p><p>done</p><p>for file in $files&nbsp;</p><p>&nbsp; do rm -f $file&nbsp;</p><p>done;</p><p>&nbsp;</p><p>gzip $tarname</p><p>&nbsp;</p><p># find all logfiles and rename them .log-&gt;.log.DATE_TIME.bak-for-cleanup</p><p>find . -name "*.log" -exec sh -c 'mv "$0" "${0%}.$(date +%Y-%m-%d_%H-%M-%S)".bak-for-cleanup' {} \;</p><p>&nbsp;</p><p># find all logfiles and rename them .log-&gt;.logfile.DATE_TIME.sysbak</p><p># find . -name "*.log" -exec sh -c 'mv "$0" "${0%.log}.logfile.$(date +%Y-%m-%d_%H-%M-%S)".sysbak' {} \;</p>°date§11.9.2015°files§°art§Wissen